Homework Problems
357
4
movq
%rax, 184(%rdi)
5
ret
What are the values of A and B? (The solution is unique.)
3.69 ◆◆◆
You are charged with maintaining a large C program, and you come across the
following code:
1
typedef struct {
2
int first;
3
a_struct a[CNT];
4
int last;
5
} b_struct;
6
7
void test(long i, b_struct *bp)
8
{
9
int n = bp->first + bp->last;
10
a_struct *ap = &bp->a[i];
11
ap->x[ap->idx] = n;
12
}
The declarations of the compile-time constant CNT and the structure a_struct
are in a ﬁle for which you do not have the necessary access privilege. Fortunately,
you have a copy of the .o version of code, which you are able to disassemble with
the objdump program, yielding the following disassembly:
void test(long i, b_struct *bp)
i in %rdi, bp in %rsi
1
0000000000000000 <test>:
2
0:
8b 8e 20 01 00 00
mov
0x120(%rsi),%ecx
3
6:
03 0e
add
(%rsi),%ecx
4
8:
48 8d 04 bf
lea
(%rdi,%rdi,4),%rax
5
c:
48 8d 04 c6
lea
(%rsi,%rax,8),%rax
6
10:
48 8b 50 08
mov
0x8(%rax),%rdx
7
14:
48 63 c9
movslq %ecx,%rcx
8
17:
48 89 4c d0 10
mov
%rcx,0x10(%rax,%rdx,8)
9
1c:
c3
retq
Using your reverse engineering skills, deduce the following:
A. The value of CNT.
B. A complete declaration of structure a_struct. Assume that the only ﬁelds
in this structure are idx and x, and that both of these contain signed values.
